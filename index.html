<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note-Taking App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="manifest" href="manifest.json">
  </head>
  <body>
    <div class="container mt-4 mb-5">
      <h1 class="text-center mb-4">Note-Taking</h1>
  
      <!-- All Notes View -->
      <div id="allNotesView">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button id="newNoteBtn" class="btn btn-primary fw-medium"><i class="bi bi-plus-circle"></i> New Note</button>
          <select id="sortSelect" class="form-select fw-medium" style="width: auto;">
            <option value="newest">Newest</option>
            <option value="oldest">Oldest</option>
          </select>
        </div>
        <div id="noteList" class="list-group"></div>
      </div>
  
      <!-- Single Note View -->
      <div id="singleNoteView" style="display: none;">
        <h2 id="noteTitle" class="mb-3 d-none"></h2>
        <p id="noteDate" class="text-muted mb-2"></p>
        <textarea id="noteContent" class="form-control mb-3" rows="10"></textarea>
        <div class="d-flex justify-content-between">
          <div class="btn-group" role="group">
            <button id="deleteBtn" class="btn btn-danger fw-medium">Delete</button>
          </div>
          <button id="backBtn" class="btn btn-secondary fw-medium">Back</button>
        </div>
      </div>
    </div>
  
    <script>
      const allNotesView = document.getElementById('allNotesView');
      const singleNoteView = document.getElementById('singleNoteView');
      const newNoteBtn = document.getElementById('newNoteBtn');
      const sortSelect = document.getElementById('sortSelect');
      const noteList = document.getElementById('noteList');
      const noteTitle = document.getElementById('noteTitle');
      const noteDate = document.getElementById('noteDate');
      const noteContent = document.getElementById('noteContent');
      const deleteBtn = document.getElementById('deleteBtn');
      const backBtn = document.getElementById('backBtn');
  
      let notes = {};
      let currentNote = null;
      let autoSaveTimeout = null;
  
      function loadNotes() {
        const savedNotes = localStorage.getItem('notes');
        if (savedNotes) {
          notes = JSON.parse(savedNotes);
        }
      }
  
      function saveNotes() {
        localStorage.setItem('notes', JSON.stringify(notes));
      }
  
      loadNotes();
  
      newNoteBtn.addEventListener('click', createNote);
      deleteBtn.addEventListener('click', deleteNote);
      backBtn.addEventListener('click', showAllNotes);
      sortSelect.addEventListener('change', updateNoteList);
      noteContent.addEventListener('input', () => {
        clearTimeout(autoSaveTimeout);
        autoSaveTimeout = setTimeout(saveNote, 500);
      });
  
      function createNote() {
        const noteId = Date.now().toString();
        notes[noteId] = {
          title: 'New Note',
          content: '',
          date: new Date().toISOString()
        };
        currentNote = noteId;
        saveNotes();
        showSingleNote();
      }
  
      function saveNote() {
        if (currentNote) {
          notes[currentNote].content = noteContent.value;
          notes[currentNote].title = noteContent.value.split('\n')[0] || 'Untitled';
          notes[currentNote].date = new Date().toISOString();
          saveNotes();
          noteTitle.textContent = notes[currentNote].title;
          noteDate.textContent = new Date(notes[currentNote].date).toLocaleDateString('en-US');
          updateNoteList();
        }
      }
  
      function deleteNote(noteId = currentNote) {
        if (noteId) {
          if (confirm('Are you sure you want to delete this note?')) {
            delete notes[noteId];
            saveNotes();
            if (noteId === currentNote) {
              showAllNotes();
            } else {
              updateNoteList();
            }
          }
        }
      }
  
      function showAllNotes() {
        allNotesView.style.display = 'block';
        singleNoteView.style.display = 'none';
        currentNote = null;
        updateNoteList();
      }
  
      function showSingleNote() {
        allNotesView.style.display = 'none';
        singleNoteView.style.display = 'block';
        if (currentNote) {
          noteTitle.textContent = notes[currentNote].title;
          noteDate.textContent = new Date(notes[currentNote].date).toLocaleDateString('en-US');
          noteContent.value = notes[currentNote].content;
        }
      }
  
      function updateNoteList() {
        noteList.innerHTML = '';
        const sortedNotes = Object.entries(notes).sort((a, b) => {
          const dateA = new Date(a[1].date);
          const dateB = new Date(b[1].date);
          return sortSelect.value === 'newest' ? dateB - dateA : dateA - dateB;
        });
  
        for (const [noteId, note] of sortedNotes) {
          const noteElem = document.createElement('a');
          noteElem.innerHTML = `
            <strong>${note.title}</strong><br>
            <small class="text-muted">${new Date(note.date).toLocaleDateString('en-US')}</small>
            <button class="btn btn-outline-danger border-0 btn-sm position-absolute top-0 end-0 m-2"><i class="bi bi-trash3-fill"></i></button>
          `;
          noteElem.href = '#';
          noteElem.className = 'position-relative p-4 rounded-4 border-0 bg-body-tertiary text-decoration-none text-white my-2 d-block position-relative';
          noteElem.addEventListener('click', (e) => {
            if (!e.target.classList.contains('delete-btn')) {
              e.preventDefault();
              currentNote = noteId;
              showSingleNote();
            }
          });
          noteElem.querySelector('.delete-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            deleteNote(noteId);
          });
          noteList.appendChild(noteElem);
        }
      }
  
      showAllNotes();
  
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(registration => {
            console.log('Service Worker registered with scope:', registration.scope);
          }).catch(error => {
            console.log('Service Worker registration failed:', error);
          });
      }
    </script>
  </body>
</html>
